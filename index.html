<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Meeting - AIèµ‹èƒ½ç»„ä¼šè®¨è®º</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-realtime.css">
    <link rel="stylesheet" href="loading.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- ä½¿ç”¨æ›´å¿«çš„å›¾æ ‡CDN -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <!-- å¤‡ç”¨å›¾æ ‡CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <!-- å›¾æ ‡é¢„åŠ è½½ -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" as="style">
    <!-- PDF.js for PDF text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Mammoth.js for Word document text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <!-- SheetJS for Excel file processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Socket.IO for real-time communication -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-users"></i> Vibe Meeting</h1>
                <p>AIè®¨è®ºå¹³å°</p>
            </div>
            <div class="room-info">
                <span class="room-id" id="roomId">æˆ¿é—´: meeting-001</span>
                <button class="btn-secondary" onclick="copyRoomId(event)">
                    <i class="fas fa-copy"></i> å¤åˆ¶æˆ¿é—´å·
                </button>

            </div>
        </header>

        <!-- ç§»åŠ¨ç«¯å¯¼èˆª -->
        <div class="mobile-nav" id="mobileNav" style="display: none;">
            <button class="mobile-nav-btn active" data-tab="chat">
                <i class="fas fa-comments"></i>
                <span>èŠå¤©</span>
            </button>
            <button class="mobile-nav-btn" data-tab="participants">
                <i class="fas fa-user-friends"></i>
                <span>æˆå‘˜</span>
            </button>
            <button class="mobile-nav-btn" data-tab="ai">
                <i class="fas fa-robot"></i>
                <span>AIå·¥å…·</span>
            </button>
        </div>

        <main class="main-content">
            <div class="left-sidebar">
                <button class="sidebar-close" id="sidebarClose" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="participants-panel">
                    <h3><i class="fas fa-user-friends"></i> åœ¨çº¿æˆå‘˜</h3>
                    <div class="participants-search">
                        <input type="text" id="participantsSearch" placeholder="æœç´¢åœ¨çº¿æˆå‘˜..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="participants-list" id="participantsList">
                        <!-- å‚ä¸è€…å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <!-- å®æ—¶è½¬å½•é¢æ¿ (ç°åœ¨åœ¨å·¦ä¾§åœ¨çº¿æˆå‘˜ä¸‹æ–¹) -->
                <div class="transcription-panel">
                    <div class="transcription-header">
                        <h3><i class="fas fa-closed-captioning"></i> å®æ—¶è½¬å½•</h3>
                        <div class="transcription-actions">
                            <button class="btn-download" id="downloadBtn" onclick="downloadTranscription()" title="ä¸‹è½½è½¬å½•æ–‡æ¡£" style="display: none;">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="transcription-controls">
                        <button class="btn-start-recording" id="startRecordBtn" onclick="startTranscription()">
                            <i class="fas fa-microphone"></i> Assemblyè½¬å½•
                        </button>
                        <button class="btn-stop-recording" id="stopRecordBtn" onclick="stopTranscription()" style="display: none;">
                            <i class="fas fa-stop"></i> åœæ­¢Assemblyè½¬å½•
                        </button>
                        
                        <!-- ç§‘å¤§è®¯é£è½¬å½•æŒ‰é’® -->
                        <button class="btn-xfyun-recording" id="xfyunStartBtn" onclick="startXfyunTranscription()" title="å¼€å§‹ç§‘å¤§è®¯é£å®æ—¶è½¬å½•">
                            <i class="fas fa-microphone"></i> ç§‘å¤§è®¯é£è½¬å½•
                        </button>
                        <button class="btn-xfyun-stop" id="xfyunStopBtn" onclick="stopXfyunTranscription()" style="display: none;" title="åœæ­¢ç§‘å¤§è®¯é£è½¬å½•">
                            <i class="fas fa-stop"></i> åœæ­¢ç§‘å¤§è®¯é£è½¬å½•
                        </button>
                        
                        <div class="transcription-status" id="transcriptionStatus">
                            <i class="fas fa-microphone-slash"></i>
                            <span>è½¬å½•å·²åœæ­¢</span>
                        </div>
                    </div>
                    <div class="transcription-content" id="transcriptionContent">
                        <div class="transcription-history" id="transcriptionHistory">
                            <div class="transcription-placeholder">
                                <i class="fas fa-info-circle"></i>
                                <p>ç‚¹å‡»"Assemblyè½¬å½•"æˆ–"ç§‘å¤§è®¯é£è½¬å½•"æŒ‰é’®å¼€å§‹è¯­éŸ³è½¬å½•</p>
                                <p>æ”¯æŒä¸­è‹±æ–‡å®æ—¶è½¬å½•</p>
                            </div>
                        </div>
                    </div>
                </div>

                
                <!-- Hugging Faceç¯å¢ƒæç¤º -->
                <div class="hf-notice" id="hfNotice" style="display: none;">
                    <div class="notice-content">
                        <i class="fas fa-info-circle"></i>
                        <h4>ğŸ’¡ æ•°æ®ä¿å­˜æç¤º</h4>
                        <p>åœ¨Hugging Faceç¯å¢ƒä¸‹ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢æ•°æ®ä¼šé‡ç½®ã€‚</p>
                        <p><strong>ä¿å­˜æ–¹æ³•ï¼š</strong>æ•°æ®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ</p>
                        <p><strong>æ¢å¤æ–¹æ³•ï¼š</strong>ä½¿ç”¨ç›¸åŒçš„æˆ¿é—´å·é‡æ–°åŠ å…¥å³å¯</p>
                    </div>
                </div>
            </div>
            
            <div class="chat-container">
                <div class="chat-header">
                    <h3><i class="fas fa-comments"></i> è®¨è®ºè®°å½•</h3>
                    <div class="chat-search">
                        <input type="text" id="chatSearchInput" placeholder="æœç´¢èŠå¤©è®°å½•..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="status-indicators">
                        <div class="connection-status">
                            <span class="connection-indicator" id="connectionStatus">
                                <i class="fas fa-wifi"></i> è¿æ¥ä¸­...
                            </span>
                        </div>
                        <div class="ai-status">
                            <span class="ai-indicator" id="aiStatus">
                                <i class="fas fa-robot"></i> AIæ­£åœ¨å¾…å‘½...
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="messages-container" id="messagesContainer">
                    <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                </div>

                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea 
                            id="messageInput" 
                            placeholder="è¾“å…¥æ‚¨çš„æ¶ˆæ¯... æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼  (æŒ‰Enterå‘é€ï¼ŒShift+Enteræ¢è¡Œ)"
                            rows="1"
                        ></textarea>
                        <button class="btn-primary" onclick="sendMessage()" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="input-actions">
                        <button class="btn-ask-ai" onclick="askAI()">
                            <i class="fas fa-question-circle"></i> è¯¢é—®AI
                        </button>
                        <button class="btn-summarize" onclick="generateSummary()">
                            <i class="fas fa-file-alt"></i> ç”Ÿæˆæ€»ç»“
                        </button>
                        <button class="btn-upload" onclick="triggerFileUpload()">
                            <i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶
                        </button>
                        <button class="btn-voice" id="voiceBtn" onclick="toggleVoiceRecording()" title="è¯­éŸ³å½•åˆ¶">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="btn-transcribe" id="transcribeBtn" onclick="toggleTranscription()" title="å®æ—¶è½¬å½•">
                            <i class="fas fa-closed-captioning"></i>
                        </button>
                        <button class="btn-call" id="callBtn" onclick="toggleVoiceCall()" title="è¯­éŸ³é€šè¯">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="btn-test-mic" id="testMicBtn" onclick="testMicrophonePermission()" title="æµ‹è¯•éº¦å…‹é£">
                            <i class="fas fa-microphone-slash"></i>
                        </button>
                        <input type="file" id="fileInput" style="display: none" multiple>
                    </div>
                    <div class="upload-zone" id="uploadZone" style="display: none;">
                        <div class="upload-zone-content">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-sidebar">
                <button class="sidebar-close" id="aiPanelClose" style="display: none;">
                    <i class="fas fa-times"></i>
                </button>
                
                <!-- AIå·¥å…·ç®±é¢æ¿ (ç°åœ¨åœ¨é¡¶éƒ¨) -->
                <div class="ai-toolbox-panel">
                    <h3><i class="fas fa-robot"></i> AIå·¥å…·ç®±</h3>
                    <div class="toolbox-content">
                        <div class="toolbox-placeholder" id="toolboxPlaceholder">
                            <i class="fas fa-magic"></i>
                            <p>é€‰æ‹©æ–‡ä»¶åä½¿ç”¨AIå·¥å…·</p>
                        </div>
                        <div class="toolbox-active" id="toolboxActive" style="display: none;">
                            <div class="current-file">
                                <i class="fas fa-file"></i>
                                <span id="currentFileName">æ–‡ä»¶å</span>
                            </div>
                            <div class="toolbox-buttons">
                                <button class="tool-btn" id="ocrBtn" onclick="performOCR()" title="OCRæ–‡å­—è¯†åˆ«">
                                    <i class="fas fa-eye"></i>
                                    <span>æ–‡å­—è¯†åˆ«</span>
                                </button>
                                <button class="tool-btn" id="translateBtn" onclick="translateText()" title="ç¿»è¯‘æ–‡æœ¬">
                                    <i class="fas fa-language"></i>
                                    <span>ç¿»è¯‘</span>
                                </button>
                                <button class="tool-btn" id="summarizeBtn" onclick="summarizeText()" title="æ€»ç»“å†…å®¹">
                                    <i class="fas fa-file-text"></i>
                                    <span>æ€»ç»“</span>
                                </button>
                                <button class="tool-btn" id="keywordsBtn" onclick="extractKeywords()" title="æå–å…³é”®è¯">
                                    <i class="fas fa-key"></i>
                                    <span>å…³é”®è¯</span>
                                </button>
                            </div>
                        </div>
                        <div class="toolbox-loading" id="toolboxLoading" style="display: none;">
                            <div class="loading-spinner">
                                <div class="spinner"></div>
                                <p>AIå¤„ç†ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="ai-summary-panel">
                    <h3><i class="fas fa-clipboard-list"></i> AIæ€»ç»“</h3>
                    <div class="summary-content" id="summaryContent">
                        <p class="empty-summary">è®¨è®ºå¼€å§‹åï¼ŒAIå°†ä¸ºæ‚¨ç”Ÿæˆæ™ºèƒ½æ€»ç»“...</p>
                    </div>
                    <button class="btn-export" onclick="exportSummary()">
                        <i class="fas fa-download"></i> å¯¼å‡ºæ€»ç»“
                    </button>
                </div>
                

            </div>
        </main>
    </div>

    <!-- ç”¨æˆ·åè®¾ç½®å¯¹è¯æ¡† -->
    <div class="modal" id="usernameModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ¬¢è¿åŠ å…¥ä¼šè®®</h3>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="usernameInput">æ‚¨çš„å§“å</label>
                    <input 
                        type="text" 
                        id="usernameInput" 
                        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
                        maxlength="20"
                        autocomplete="off"
                    />
                </div>
                
                <div class="input-group">
                    <label for="roomInput">æˆ¿é—´å·</label>
                    <input 
                        type="text" 
                        id="roomInput" 
                        placeholder="ç•™ç©ºåˆ›å»ºæ–°æˆ¿é—´"
                        maxlength="20"
                        autocomplete="off"
                    />
                    <small>å·²æœ‰æˆ¿é—´å·ï¼Ÿè¾“å…¥å³å¯åŠ å…¥è®¨è®º</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="createNewRoom()">æ–°å»ºæˆ¿é—´</button>
                <button class="btn-primary" onclick="setUsername()">åŠ å…¥ä¼šè®®</button>
            </div>
        </div>
    </div>

    <!-- è¯¢é—®AIå¯¹è¯æ¡† -->
    <div class="modal" id="askAIModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è¯¢é—®AI</h3>
                <button class="modal-close" onclick="closeAskAIModal()">&times;</button>
            </div>
            <div class="modal-body">
                <textarea 
                    id="aiQuestionInput" 
                    placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."
                    rows="3"
                ></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAskAIModal()">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="submitAIQuestion()">å‘é€</button>
            </div>
        </div>
    </div>

    <!-- è¯­éŸ³å½•åˆ¶å¯¹è¯æ¡† -->
    <div class="modal" id="voiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è¯­éŸ³å½•åˆ¶</h3>
                <button class="modal-close" onclick="closeVoiceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="voice-recorder">
                    <div class="voice-status" id="voiceStatus">
                        <i class="fas fa-microphone"></i>
                        <span>ç‚¹å‡»å¼€å§‹å½•åˆ¶</span>
                    </div>
                    <div class="voice-controls">
                        <button class="btn-record" id="recordBtn" onclick="startRecording()">
                            <i class="fas fa-microphone"></i> å¼€å§‹å½•åˆ¶
                        </button>
                        <button class="btn-stop" id="stopBtn" onclick="stopRecording()" style="display: none;">
                            <i class="fas fa-stop"></i> åœæ­¢å½•åˆ¶
                        </button>
                        <button class="btn-play" id="playBtn" onclick="playRecording()" style="display: none;">
                            <i class="fas fa-play"></i> æ’­æ”¾
                        </button>
                    </div>
                    <div class="voice-transcript" id="voiceTranscript" style="display: none;">
                        <h4>è½¬å½•æ–‡æœ¬</h4>
                        <textarea id="transcriptText" placeholder="è½¬å½•æ–‡æœ¬å°†åœ¨è¿™é‡Œæ˜¾ç¤º..." rows="4"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeVoiceModal()">å–æ¶ˆ</button>
                <button class="btn-primary" id="sendVoiceBtn" onclick="sendVoiceMessage()" style="display: none;">
                    <i class="fas fa-paper-plane"></i> å‘é€è¯­éŸ³
                </button>
            </div>
        </div>
    </div>



    <!-- è¯­éŸ³é€šè¯é¢æ¿ -->
    <div class="voice-call-panel" id="voiceCallPanel" style="display: none;">
        <div class="call-header">
            <h3><i class="fas fa-phone"></i> è¯­éŸ³é€šè¯</h3>
            <div class="call-info">
                <span id="callDuration">00:00</span>
                <span id="callParticipants">0 äººå‚ä¸</span>
            </div>
            <button class="call-close" onclick="endVoiceCall()">&times;</button>
        </div>
        <div class="call-content">
            <div class="call-participants" id="callParticipantsList">
                <!-- é€šè¯å‚ä¸è€…åˆ—è¡¨ -->
            </div>
            <div class="call-controls">
                <button class="call-control-btn" id="muteBtn" onclick="toggleMute()" title="é™éŸ³">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-control-btn" id="speakerBtn" onclick="toggleSpeaker()" title="æ‰¬å£°å™¨">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button class="call-control-btn call-end" onclick="endVoiceCall()" title="ç»“æŸé€šè¯">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- æ¥ç”µæç¤º -->
    <div class="incoming-call-modal" id="incomingCallModal" style="display: none;">
        <div class="incoming-call-content">
            <div class="caller-info">
                <i class="fas fa-phone"></i>
                <h4 id="incomingCallerName">æ¥ç”µ</h4>
                <p>è¯­éŸ³é€šè¯é‚€è¯·</p>
            </div>
            <div class="incoming-call-controls">
                <button class="btn-accept" onclick="acceptCall()">
                    <i class="fas fa-phone"></i> æ¥å¬
                </button>
                <button class="btn-reject" onclick="rejectCall()">
                    <i class="fas fa-phone-slash"></i> æ‹’ç»
                </button>
            </div>
        </div>
    </div>

    <!-- å®æ—¶é€šä¿¡å®¢æˆ·ç«¯ -->
    <script src="realtime-client.js"></script>
    <!-- AIè¯­éŸ³è½¬å½•å®¢æˆ·ç«¯ -->
    <script src="transcription-client.js"></script>
    <!-- ä¸»åº”ç”¨è„šæœ¬ -->
    <script src="app.js"></script>
    
    <!-- ç§‘å¤§è®¯é£å®æ—¶è¯­éŸ³è½¬å†™ -->
    <script src="xfyun-realtime-transcription.js"></script>
    
    <script>
        // åˆå§‹åŒ–è½¬å½•å®¢æˆ·ç«¯
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof TranscriptionClient !== 'undefined') {
                window.transcriptionClient = new TranscriptionClient();
                await window.transcriptionClient.init();
                console.log('ğŸ¤ è½¬å½•å®¢æˆ·ç«¯å·²å‡†å¤‡å°±ç»ª');
            } else {
                console.warn('âš ï¸ TranscriptionClient æœªæ‰¾åˆ°');
            }
            
            // åˆå§‹åŒ–ç§‘å¤§è®¯é£è½¬å½•å®¢æˆ·ç«¯
            if (typeof XunfeiRealtimeTranscription !== 'undefined') {
                console.log('ğŸ¤ ç§‘å¤§è®¯é£è½¬å½•å®¢æˆ·ç«¯å·²å‡†å¤‡å°±ç»ª');
            } else {
                console.warn('âš ï¸ ç§‘å¤§è®¯é£è½¬å½•å®¢æˆ·ç«¯æœªæ‰¾åˆ°');
            }
            
            // æ·»åŠ è°ƒè¯•åŠŸèƒ½åˆ°å…¨å±€
            window.debugConnection = function() {
                console.log('ğŸ”§ å¼€å§‹è¿æ¥è°ƒè¯•...');
                if (window.realtimeClient) {
                    return window.realtimeClient.testConnection();
                } else {
                    console.error('âŒ å®æ—¶å®¢æˆ·ç«¯æœªåˆå§‹åŒ–');
                    return false;
                }
            };
            
            window.testSocketIO = function() {
                console.log('ğŸ§ª æµ‹è¯•Socket.IOåŠ è½½çŠ¶æ€...');
                console.log('Socket.IOåº“:', typeof io !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½');
                if (typeof io !== 'undefined') {
                    console.log('Socket.IOç‰ˆæœ¬:', io.version || 'æœªçŸ¥');
                }
                
                if (window.realtimeClient && window.realtimeClient.socket) {
                    console.log('å½“å‰è¿æ¥çŠ¶æ€:', window.realtimeClient.socket.connected);
                    console.log('ä¼ è¾“æ–¹å¼:', window.realtimeClient.socket.io?.engine?.transport?.name);
                }
            };
            
            console.log('ğŸ’¡ è°ƒè¯•æç¤º: ä½¿ç”¨ debugConnection() æµ‹è¯•è¿æ¥ï¼Œä½¿ç”¨ testSocketIO() æ£€æŸ¥Socket.IOçŠ¶æ€');
        });
    </script>
</body>
</html>
